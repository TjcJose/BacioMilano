@using Ad.Model.VModel;
@using Ad.Model.DbModel;
@using Ad.Fw;
@using Ad.Tools.Web;
@using Ad.Util;

@model VModel_BankTransferMoneyList

@{
    var config = ConfigHelper.Config_Instance;
}

@{
    bool isAdd = this.ViewBag.isAdd;
    bool isExcel = this.ViewBag.isExcel;
}

<script id='template_search_BankTransferMoney_id' type='text/x-dot-template'>
    <table class='table table-striped table-bordered table-hover'>
        <thead>
            <tr>
                <th nowrap='nowrap'>交易时间</th>
                <th nowrap='nowrap'>操作人名字</th>
                <th nowrap='nowrap'>银行账户</th>
                <th nowrap='nowrap'>支出</th>
                <th nowrap='nowrap'>收入</th>
                <th nowrap='nowrap'>备注</th>
                @*<th nowrap='nowrap'>备注</th>*@
            </tr>
        </thead>
        <tbody>
            {{~it.Models :data:index}}
            <tr>
                <td>{{!data.TransactionDateStr}}</td>
                <td>{{!data.ManagerName}}</td>
                <td>{{!data.AccountName}}</td>
                <td>{{!data.Expenditure}}</td>
                <td>{{!data.Receivables}}</td>
                <td>{{!data.Remark}}</td>
                @*<td><a href='#' onclick='abtn_see_BankTransferMoney({{=index}})'>查看</a></td>*@
            </tr>
            {{~}}
        </tbody>
    </table>
    <div id='div_search_splitpage_BankTransferMoney_id' class='pagination pagination-sm'></div>
</script>
<form method='post' id='search_frm_BankTransferMoney' class="form-horizontal" action="/BankTransferMoney/BankTransferMoneyExport">
    <div class="form-group">
        @Html.TextBoxFor(m => m.Transaction_1S, new { @class = "form-control  ad_mr_word", @placeholder = "Date1", @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear: true })" })
        <label for="" class="control-label"> <= 交易日期 <= </label>
        @Html.TextBoxFor(m => m.Transaction_2S, new { @class = "form-control  ad_mr_word", @placeholder = "Date2", @onfocus = "WdatePicker({dateFmt:'yyyy-MM-dd',isShowClear: true })" })
        @Html.LabelFor(m => m.AccountId_1S, new { @class = "control-label" })
        @Html.SelectList((IEnumerable<T_WokeeBank>)ViewBag.WokeeBankList, T_WokeeBank_Description.Id, T_WokeeBank_Description.ShortName,
                                      "AccountId_1S", true, "", null, new { @class = "form-control", @style = "width:200px;" })
    </div>
    <div class="form-group">
        @if (isExcel)
        {
            <input type="button" class="btn btn-default ad_mr_word" value="导出" onclick="abtn_export_bankTransferMoney()" />
            <script>
                function abtn_export_bankTransferMoney() {
                    $("#search_frm_BankTransferMoney").submit();
                }
            </script>
        }
        <input type='button' id='btnSearch_BankTransferMoney' value='筛选' class='btn btn-default ad_mr_word' />
        @if (isAdd)
        {
            <input type='button' class='btn btn-default submit_ml' value='添加入款' id="abtn_add_receive_banktransfermoney">
            <input type='button' class='btn btn-default submit_ml' value='添加支出' id="abtn_add_expenditure_banktransfermoney">
            <script>
                $("#abtn_add_receive_banktransfermoney").click(function () {
                    var title = '添加入款';
                    var url = '/BankTransferMoney/Add_BankTransferMoney_Receivables'
                    $.ad.dialog_modal(url, title, '加载中...', function (e) {
                        if ($.ad.getOperValue()) {
                            search_BankTransferMoney();
                        }
                    });
                });

                $("#abtn_add_expenditure_banktransfermoney").click(function () {
                    var title = '添加支出';
                    var url = '/BankTransferMoney/Add_BankTransferMoney_Expenditure'
                    $.ad.dialog_modal(url, title, '加载中...', function (e) {
                        if ($.ad.getOperValue()) {
                            search_BankTransferMoney();
                        }
                    });
                })
            </script>
        }
    </div>
    @Html.Hidden("pageIndex_BankTransferMoney", 1)
    @Html.Hidden("pageSize_BankTransferMoney", config.PageSize)

</form>
<div id='divSearchResult_BankTransferMoney' class='ad_table'></div>



<script>
    var datas_BankTransferMoney;
    function search_BankTransferMoney() {
        $.post('/BankTransferMoney/Split_BankTransferMoney', $('#search_frm_BankTransferMoney').serializeArray()).done(function (datas){
            datas_BankTransferMoney = datas;
            var url = '/BankTransferMoney/Split_BankTransferMoney'
            var tempFn = doT.template($('#template_search_BankTransferMoney_id').html());
            var html = tempFn(datas);
            $('#divSearchResult_BankTransferMoney').html(html);
            $.ad.split_page(datas.PageIndex, datas.PageCount, datas.PageSize, datas.RecordCount, 'pageIndex_BankTransferMoney', 'search_frm_BankTransferMoney', 'div_search_splitpage_BankTransferMoney_id', search_BankTransferMoney)
        });
    }

    $('#btnSearch_BankTransferMoney').click(function (e)
    {
        $('#pageIndex_BankTransferMoney').val(1);
        search_BankTransferMoney();
    });

    search_BankTransferMoney();
</script>